<html>
<head>
<title>Poem network â€” Runoregi</title>
<script
    type="text/javascript"
    src="https://visjs.github.io/vis-network/standalone/umd/vis-network.min.js"
  ></script>
<style type="text/css">
      #poemnet {
        width: 100%;
        height: 750;
        border: 1px solid lightgray;
      }
    </style>
</head>

<body>

<h1>Poem network</h1>

[<a href="/{% if args['nro'] | length > 1 %}multidiff{% else %}poem{% endif %}?nro={{ args['nro'] | join(',') }}">back to {% if args['nro'] | length > 1 %}alignment{% else %}poem{% endif %}</a>]
[<a href="{{ links['+maxdepth'] }}">+</a>
/ <a href="{{ links['-maxdepth'] }}">-</a>
depth]
[<a href="{{ links['+nodes'] }}">+</a>
/ <a href="{{ links['-nodes'] }}">-</a>
nodes]
[<a href="{{ links['+threshold'] }}">+</a>
/ <a href="{{ links['-threshold'] }}">-</a>
threshold]

<div id="poemnet"></div>
<script type="text/javascript">
      // create an array with nodes
      var nodes = new vis.DataSet([
        {% for nro, p in data['poemnet']['nodes'].items() %}
          { id: {{ p.nro | tojson }}, label: {{ p.smd.title | tojson }},
            title: "{{ p.smd.location }}\n{{ p.smd.year }} {{ p.smd.collector }}\n"
                   {% for line in p.type_tree %}
				   + "\n{{ line.prefix | join('\u2003') }} {% if line['is_minor']%}*{% endif %}{{ data['types'][line.type_id].name }}"
                   {% endfor %},
            shape: "box", {% if p.nro in args['nro'] %}color: "#FFEEAA",{% endif %}
            link: "/poem?nro={{ p.nro }}"},
        {% endfor %}
      ]);

      // create an array with edges
      var edges = new vis.DataSet([
        {% for e in data['poemnet']['edges'] %}
          { from: {{ e[0] | tojson }}, to: {{ e[1] | tojson }},
            value: {{ e[2] }}, title: "{{ e[2] }}",
            link: "/poemdiff?nro1={{ e[0] }}&nro2={{ e[1] }}" },
        {% endfor %}
      ]);

      // create a network
      var container = document.getElementById("poemnet");
      var data = {
        nodes: nodes,
        edges: edges,
      };
      var options = { physics: { enabled: false }  };
      var network = new vis.Network(container, data, options);
      network.on("doubleClick", function (params) {
        opened = false
        for (n of nodes.get(params.nodes)) {
          if (n.link) {
            window.open(n.link)
            opened = true
            break
          }
        }
        if (!opened) {
            for (e of edges.get(params.edges)) {
              if (e.link) {
                window.open(e.link)
              }
            }
        }
      });
    </script>
</body>
</html>