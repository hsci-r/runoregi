<html>
<head>
<title>#{{ data['verse'].clust_id }} {{ data['verse'].text }}</title>
</head>

<body>
<h1><small>#{{ data['verse'].clust_id }}</small> {{ data['verse'].text }}</h1>
[<a href="/poem?nro={{ args['nro'] }}">back to poem</a>]
[<a href="/verse?nro={{ args['nro'] }}&pos={{ args['pos'] }}{% if args['clustering'] > 0 %}&clustering={{ args['clustering'] }}{% endif %}&format=csv">CSV</a>
/ <a href="/verse?nro={{ args['nro'] }}&pos={{ args['pos'] }}{% if args['clustering'] > 0 %}&clustering={{ args['clustering'] }}{% endif %}&format=tsv">TSV</a>]
[<a href="{{ links['map_lnk'] }}">map</a>]
[<a href="/clustnet?nro={{ args['nro'] }}&pos={{ args['pos'] }}">cluster network</a>]<br/>

<h2>Cluster ({{ data['verse'].clust_freq }})</h2>
clustering:
{% for c in data['clusterings'] %}
{% if args['clustering'] == c[0] %}
{{ c[1] }}
{% else %}
<a href="/verse?nro={{ args['nro'] }}&pos={{ args['pos'] }}{% if c[0] > 0 %}&clustering={{ c[0] }}{% endif %}">{{ c[1] }}</a>
{% endif %}
{% endfor %}
<table>
  <tr><td><hr/></td></tr>
  {% for nro, verses in data['verses'].items() %}
  <tr><td{% if nro == args['nro'] %} bgcolor="FFEEAA"{% endif %}>
    <table>
    <tr>
      <td valign="top">
        <b><a href="/poem?nro={{ nro }}&hl={{ verses | map(attribute='pos') | join(',')  }}#{{ verses | map(attribute='pos') | min }}">
        {{ data['poems'][nro].smd.title }}
        </a></b>
      </td>
      <td>
        <table border="0" cellpadding="0" cellspacing="0">
        {% for v in verses %}
        <tr>
        <td align="right"><sup><small>{{ v.pos }}</small></sup>&thinsp;</td>
        <td><b>{{ v.text }}</b></td>
        </tr>
        {% endfor %}
        </table>
      </td>
    </tr>
    </table>
    <table>
    <tr>
    <td valign="top" width="400">
      &emsp;<small>{{ nro }}</small><br/>
      &emsp;{{ data['poems'][nro].smd.location }}<br/>
      &emsp;{{ data['poems'][nro].smd.year }}&ensp;{{ data['poems'][nro].smd.collector }}
    </td>
    <td valign="top" width="400">
      <small>
      {% for line in data['poems'][nro].type_tree %}
      {% if line.is_minor %}<font color="gray">{% endif %}{{ line.prefix | join('\u2003') }} {{ data['types'][line.type_id].name }}{% if line.is_minor %}</font>{% endif %}<br/>
      {% endfor %}
      </small>
    </td>
    </tr>
    {% if nro in data['nbclust'] %}
    <tr><td width="800" colspan="2">
    <small>
    <b>See also: </b>
    {% for v in data['nbclust'][nro] %}
    <small>#{{ v.clust_id }}</small> <a href="/verse?nro={{ v.nro }}&pos={{ v.pos }}{% if args['clustering'] > 0 %}&clustering={{ args['clustering'] }}{% endif %}">{{ v.text }}</a> ({{ v.clust_freq }})
    {% endfor %}
    </small>
    </td></tr>
    {% endif %}
    </table>
  <tr><td><hr/></td></tr>
  {% endfor %}
</table>

</body>
</html>
